% Code for envelope
% a, d, and r can be [0 1000], s is [0 1]
% Sometimes this breaks when adjusting variables, but 
% works again without changing anything on second run?
% Adjustable values to be convolved with sounds

[trumpet,fs_trumpet] = audioread('/Users/Jake/BME271/Final Project/BME271Project/trumpet-C4.wav');
[violin,fs_violin] = audioread('/Users/Jake/BME271/Final Project/BME271Project/violin-C4.wav');
[piano,fs_piano] = audioread('/Users/Jake/BME271/Final Project/BME271Project/piano-C4.wav');
[flute,fs_flute] = audioread('/Users/Jake/BME271/Final Project/BME271Project/flute-C4.wav');


% Params to adjust 
a = 1000;
d = 200;
s = 1;
r = 100;

fs = 11025;
dt = 1/fs;

t = 0:dt:3.2;
td = dt:dt:d/1000;
tr = dt:dt:r/1000;

% Make the envelope
x = [0 a/1000 (a+d)/1000 (a+d+200)/1000 (a+d+r+200)/1000];
y = [0 1 s s 0];
xq = 0:dt:3.2;
vq = interp1(x, y, xq);

ttrumpet = [0:1/fs_trumpet:length(trumpet)/fs_trumpet];
tviolin = [0:1/fs_violin:length(violin)/fs_violin];
tpiano = [0:1/fs_piano:length(piano)/fs_piano];
tflute = [0:1/fs_flute:length(flute)/fs_flute];

h1 = 1;
h2 = 0;
h3 = 1;
h4 = 0;
h5 = 0.5;
h6 = 0;
h7 = 0.25;
h8 = 0;

f0 = 261.6;
test = h1 * cos(2*pi*f0*t) + h2 * cos(4*pi*f0*6) + h3 * cos(6*pi*f0*t) + ...
    h4 * cos(8*pi*f0*t) + h5 * cos(10*pi*f0*t) + h6 * cos(12*pi*f0*t) + ...
    h7 * cos(14*pi*f0*t) + h8 * cos(16*pi*f0*t);

soundsc(test .* vq, fs)

%% Plot Envelope
figure(1)
plot(xq, vq)
ylim([0 1.2])
xlim([0 3.2])

figure(2)
plot(piano)